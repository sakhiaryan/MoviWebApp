{% extends "base.html" %}
{% block content %}
  <h1>Movies · {{ user.name }}</h1>

  <div class="card">
    {% if movies %}
      <table>
        <thead>
          <tr>
            <th>Poster</th>
            <th>Title</th>
            <th>Year</th>
            <th>Rating (1–10)</th>
            <th style="width: 280px;">Actions</th>
          </tr>
        </thead>
        <tbody>
        {% for m in movies %}
          <tr>
            <td>
              {% if m.poster_url %}
                <img class="poster" src="{{ m.poster_url }}" alt="Poster of {{ m.title }}">
              {% else %}
                <span style="opacity:.7;">—</span>
              {% endif %}
            </td>
            <td>{{ m.title }}</td>
            <td>{{ m.year or "—" }}</td>
            <td>{{ m.rating or "—" }}</td>
            <td>
              <!-- Update inline form -->
              <form action="{{ url_for('update_movie', user_id=user.id, movie_id=m.id) }}" method="post" class="row">
                <div class="col">
                  <label for="title-{{ m.id }}">Title</label><br>
                  <input id="title-{{ m.id }}" name="title" value="{{ m.title }}">
                </div>
                <div class="col">
                  <label for="year-{{ m.id }}">Year</label><br>
                  <input id="year-{{ m.id }}" name="year" value="{{ m.year or '' }}">
                </div>
                <div class="col">
                  <label for="rating-{{ m.id }}">Rating</label><br>
                  <input id="rating-{{ m.id }}" name="rating" type="number" min="1" max="10" value="{{ m.rating or '' }}">
                </div>
                <div class="col">
                  <label for="poster-{{ m.id }}">Poster URL</label><br>
                  <input id="poster-{{ m.id }}" name="poster_url" value="{{ m.poster_url or '' }}">
                </div>
                <div class="col" style="align-self:end;">
                  <button class="btn secondary" type="submit">Update</button>
                </div>
              </form>

              <!-- Delete -->
              <form action="{{ url_for('delete_movie', user_id=user.id, movie_id=m.id) }}" method="post" style="margin-top:8px;">
                <button class="btn danger" type="submit" onclick="return confirm('Delete this movie?');">Delete</button>
              </form>
            </td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>No movies yet for {{ user.name }}.</p>
    {% endif %}
  </div>

  <div class="card">
    <h2>Add Movie</h2>
    <form action="{{ url_for('add_movie', user_id=user.id) }}" method="post" class="row">
      <div class="col">
        <label for="title">Title</label><br>
        <input id="title" name="title" placeholder="Movie title" required>
      </div>
      <div class="col">
        <label for="year">Year</label><br>
        <input id="year" name="year" placeholder="e.g. 2023">
      </div>
      <div class="col">
        <label for="rating">Rating (1–10)</label><br>
        <input id="rating" name="rating" type="number" min="1" max="10" placeholder="e.g. 8">
      </div>
      <div class="col">
        <label for="poster_url">Poster URL</label><br>
        <input id="poster_url" name="poster_url" placeholder="https://...">
      </div>
      <div class="col" style="align-self:end;">
        <button class="btn" type="submit">Add Movie</button>
      </div>
    </form>
  </div>
{% endblock %}