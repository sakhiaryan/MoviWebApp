{% extends "base.html" %}
{% block content %}
<section>
  <h2>Movies of {{ user.name }}</h2>

  {% if movies %}
    <div class="cards">
      {% for m in movies %}
        <div class="card">
          {% if m.poster_url %}
            <img class="poster" src="{{ m.poster_url }}" alt="poster for {{ m.title }}">
          {% endif %}
          <div class="card-body">
            <h3>{{ m.title }} {% if m.year %}({{ m.year }}){% endif %}</h3>
            <p>
              <strong>Rating:</strong>
              {% if m.rating %}{{ m.rating }}/10{% else %}<span class="muted">n/a</span>{% endif %}
            </p>

            <form method="post" action="{{ url_for('update_movie', user_id=user.id, movie_id=m.id) }}" class="form-inline">
              <input type="text" name="title" placeholder="New title (optional)" />
              <input type="number" name="rating" min="1" max="10" placeholder="New rating (1-10)" />
              <button type="submit">Update</button>
            </form>

            <form method="post" action="{{ url_for('delete_movie', user_id=user.id, movie_id=m.id) }}" onsubmit="return confirm('Delete this movie?');">
              <button type="submit" class="danger">Delete</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="muted">No movies yet.</p>
  {% endif %}
</section>

<hr />

<section>
  <h3>Add Movie</h3>
  <form method="post" action="{{ url_for('add_movie', user_id=user.id) }}" class="form-inline">
    <input type="text" name="title" placeholder="Movie title" required />
    <input type="number" name="rating" min="1" max="10" placeholder="Rating (1-10)" />
    <button type="submit">Add</button>
  </form>
  <p class="muted">Metadata will be fetched from OMDb (if OMDB_API_KEY is configured).</p>
</section>
{% endblock %}